CC=mips-linux-gnu-gcc-4.4
CFLAGS=-Wall -O3
LIB=../lib

GRAIN_OBJS=$(LIB)/grain.o grain_testvectors.o
HC128_OBJS=$(LIB)/hc128.o hc128_testvectors.o
MICKEY_OBJS=$(LIB)/mickey.o mickey_testvectors.o
RABBIT_OBJS=$(LIB)/rabbit.o rabbit_testvectors.o
SALSA_OBJS=$(LIB)/salsa.o salsa_testvectors.o
SOSEMANUK_OBJS=$(LIB)/sosemanuk.o sosemanuk_testvectors.o
TRIVIUM_OBJS=$(LIB)/trivium.o trivium_testvectors.o

GRAIN=grain_testvectors_mips
HC128=hc128_testvectors_mips
MICKEY=mickey_testvectors_mips
RABBIT=rabbit_testvectors_mips
SALSA=salsa_testvectors_mips
SOSEMANUK=sosemanuk_testvectors_mips
TRIVIUM=trivium_testvectors_mips

all: $(GRAIN) $(HC128) $(MICKEY) $(RABBIT) $(SALSA) $(SOSEMANUK) $(TRIVIUM)

.c.o:
	$(CC) $(CFLAGS) -c $^ -o $@

$(GRAIN): $(GRAIN_OBJS)
	$(CC) $(CFALGS) -o $@ $^

$(HC128): $(HC128_OBJS)
	$(CC) $(CFLAGS) -o $@ $^

$(MICKEY): $(MICKEY_OBJS)
	$(CC) $(CFLAGS) -o $@ $^

$(RABBIT): $(RABBIT_OBJS)
	$(CC) $(CFALGS) -o $@ $^

$(SALSA): $(SALSA_OBJS)
	$(CC) $(CFALGS) -o $@ $^

$(SOSEMANUK): $(SOSEMANUK_OBJS)
	$(CC) $(CFLAGS) -o $@ $^

$(TRIVIUM): $(TRIVIUM_OBJS)
	$(CC) $(CFALGS) -o $@ $^

clean:
	rm -f *.o $(LIB)/*.o
	rm -f $(GRAIN) $(HC128) $(MICKEY) $(RABBIT) $(SALSA) $(SOSEMANUK) $(TRIVIUM)

.PHONY: test
test:
	qemu-mips -L /usr/mips-linux-gnu/  $(GRAIN)
	qemu-mips -L /usr/mips-linux-gnu/  $(HC128)
	qemu-mips -L /usr/mips-linux-gnu/  $(MICKEY)
	qemu-mips -L /usr/mips-linux-gnu/  $(RABBIT)
	qemu-mips -L /usr/mips-linux-gnu/  $(SALSA)
	qemu-mips -L /usr/mips-linux-gnu/  $(SOSEMANUK)
	qemu-mips -L /usr/mips-linux-gnu/  $(TRIVIUM)
